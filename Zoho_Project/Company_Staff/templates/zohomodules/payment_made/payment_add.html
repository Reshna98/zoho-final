{% extends 'base.html' %}
{% block content %}
{% load static %}

<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!-- <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" /> -->

<style>
  .modal{
    z-index: 9999;
    overflow: scroll;
  }
  .selectize-input {
    background-color: #000 !important;
    color: white !important;
}

.selectize-input input {
    color: white !important;
}

  /* .form-group{
    width: 40%;
  } */

  .row:after {
    content: "";
    display: table;
    clear: both;
  }
  
  @media screen and (max-width: 600px) {
    .col-25, .col-75, input[type=submit] {
      width: 100%;
      margin-top: 0;
    }

    input[type=text], select, textarea {
      width: 100%;
    }
  }

  .dropdown input,
  .dropdown button {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
  }

  .dropdown.open input,
  .dropdown.open button {
    display: block;
  }

  .row a{
    color: rgb(218, 164, 48);
    font-size: 12px;
  }

  .table th a{
    color:rgb(218, 164, 48);
    font-size: 11px;
    margin-left: 100px;
  }

  ::-webkit-scrollbar {
    display: none;
  }

  ::-webkit-scrollbar-track {
    background: #f1f1f1; 
  }

  ::-webkit-scrollbar-thumb {
    background: #888; 
  }

  ::-webkit-scrollbar-thumb:hover {
    background: #555; 
  }

  .item{
    height: auto;
  }

  .labels{
    color: white; 
    font-size:2.5vh; 
    font-weight: bolder;
  }

  .btn-outline-warning:hover {
    color: black !important;
    font-weight: bold;
  }
  .dropdown-item.customers-options:hover, .dropdown-item.items-options:hover{
    background: white !important;
    color: black !important;
    cursor: pointer;
  }
</style>
<style>
  label{
      color: white;
  }
  .section-3
  {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      margin-top: 1rem;
  }
  .section-3 .section-toggle
  {
      margin-bottom: 0.50rem;
  }
   .section-toggle a
  {

      color: rgb(230, 171, 45);
      font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
      font-size:1.275rem;
  }
  .add_another
  {
     
      color: rgb(230, 171, 45);
  }
  #tbl thead th{
      font-size: 0.785rem;
  }
  @media (max-width:700px)
  {
  .section-3
  {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr ;  

  }
  .section-3 .section-toggle a
  {

      color: rgb(230, 171, 45);
      font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
      font-size:0.875rem;
  }
  }
 


  /* Account Modal */

  .select-box1 {
      position: relative;
      width: 100%;
  }
  

  .select-option1 {
      position: relative;
      
  }

  .select-option1 input {
      width: 100%;
      cursor: pointer;
      background-color: white;
      color: black;
      border-radius: 7px;
      padding: 10px 15px;
      border: 0 !important;
      outline: 0 !important;
  }

  .select-option1:after {
      content: "";
      border-top: 12px solid #000;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      position: absolute;
      right: 15px;
      top: 50%;
      margin-top: -8px;

  }

  .content1 {
      background-color: white;
      position: absolute;
      color: black;
      border-radius: 7px;
      margin-top: 15px;
      width: 100%;
      z-index: 999;
      padding: 20px;
      display: none;
  }

  .search1 input {
      width: 100%;
      font-size: 17px;
      padding: 15px;
      outline: 0;
      border: 1px solid #b3b3b3;
      border-radius: 5px;
  }

  .options1 {
      margin-top: 10px;
      max-height: 150px;
      overflow-y: scroll;
      padding: 0;
  }

  /* .options1::-webkit-scrollbar{
      width: 5px;
     
    } */
  .options1 li {
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      border-bottom: 1px solid gray;
  }

  .select-box1.active .content1 {
      display: block;
  }

  .select-box1.active .select-option1:after {
      transform: rotate(-180deg);
  }
     
</style>

<div class="body-wrapper">
  <div class="container-fluid">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'company_dashboard' %}" class="text-warning-emphasis">Dashboard</a></li>
        <li class="breadcrumb-item"><a class="text-warning-emphasis">Purchase</a></li>
        <li class="breadcrumb-item"><a href="{% url 'payment_made' %}" class="text-warning-emphasis">Payment Made</a></li>
        <li class="breadcrumb-item" aria-current="page">Create</li>
      </ol>
    </nav>
      <div class="row mt-5">
          <div class="col-md-12">
            <div class="card mb-5 px-3 py-4" style="background-color: black; border-radius: 1vh;">
              <h1 class="mb-0 text-uppercase text-right" style="color: white; font-weight: bolder;">CREATE PAYMENT MADE</h1><br>
              <hr class="text-warning">
              <form action="" method="post" enctype="multipart/form-data" id="myForm" onsubmit="return validateForm()">
                {% csrf_token %}
                <div class="row">
                  <div class="col-md-3">
                    <label for="" class="labels">Vendor</label>
                    <br>
                    <span class="text-danger" id="vendErr"></span>
                  </div>
                  <div class="col-md-6">
                    <input type="hidden" name="vendId" id="vendId" value="">
                    <div class="d-flex">
                        <div class="w-100">
                            <div class="p-0 border-0 bg-none position-relative drop-box">
                                <input required type="text" id="vendor" value="" name="vendor" class="dropdown-toggle form-control text-white customers-display" onkeyup="filtervendors()" data-bs-toggle="dropdown" aria-expanded="false" placeholder="Select Vendor.." autocomplete="off">
                                <ul class="dropdown-menu w-100 customers-available position-absolute bg-black text-white" id="vend_drop"  style="overflow-y: auto; height: fit-content;max-height: 40vh; border: 1px solid gray;"> 
                                    <li class="dropdown-item customers-options text-white" onclick="getVendorrDetails('','')">Select Vendor</li>
                                    {% for i in vendors %}
                                    <li class="dropdown-item customers-options text-white" onclick="getVendorDetails(`{{i.id}}`,this.innerHTML)">{{ i.vendor_display_name}} </li>
                                    {% endfor %}
                                </ul>
                                
                            </div>
                        </div>
                        <button type="button" data-toggle="modal" data-target="#newVendor" class="btn btn-outline-warning ms-1">+</button>
                        </div>
                  </div>
                </div>

                <div class="row mt-2">
                  <label for="" class="col-md-3 labels">Email</label>
                  <div class="col-md-6">
                    <input type="text" class="form-control text-white bg-black" id="customerEmail" name="customer_email" readonly>
                  </div>
                </div>

                <div class="row mt-2">
                  <label for="" class="col-md-3 labels">GST Type</label>
                  <div class="col-md-6">
                    <input type="text" class="form-control text-white bg-black" id="customerGstType" name="customer_gst_type" readonly>
                  </div>
                </div>

                <div class="row mt-2" id="customerGstInDisplay" style="display: flex;">
                  <label for="" class="col-md-3 labels">GSTIN</label>
                  <div class="col-md-6">
                    <input type="text" class="form-control text-white bg-black" id="customerGSTIN" name="customer_gstin" readonly>
                  </div>
                </div>

                <div class="row mt-2" id="billAddressSection">
                  <label for="" class="col-md-3 labels">Billing Address</label>
                  <div class="col-md-6">
                    <textarea class="form-control text-white bg-black" name="bill_address" id="billAddress" rows="4" readonly></textarea>
                  </div>
                </div>

                <div class="row mt-2">
                  <label for="" class="col-md-3 labels">Source of Supply</label>
                  <div class="col-md-6">
                    <input hidden value="{{cmp.state}}" id="cmpstate">
                    <select name="source_of_supply" id="sourceOfSupply" class="form-control bg-black text-white">
                      <option value="" selected>Select Source of Supply</option>
                      <option value="[AN]-Andaman And Nicobar Islands">[AN]-Andaman And Nicobar Islands</option>
                      <option value="[AD]-Andhra Pradesh">[AD]-Andhra Pradesh</option>
                      <option value="[AR]-Arunachal Pradesh">[AR]-Arunachal Pradesh	</option> 
                      <option value="[AS]-Assam">[AS]-Assam</option>
                      <option value="[BR]-Bihar">[BR]-Bihar</option> 
                      <option value="[CH]-Chandhigarh">[CH]-Chandhigarh</option>
                      <option value="[CG]-Chattisgarh">[CG]-Chattisgarh</option>
                      <option value="[DD]-Daman Diu">[DD]-Daman Diu</option>
                      <option value="[DL]-Delhi">[DL]-Delhi</option>
                      <option value="[GA]-Goa">[GA]-Goa</option> 
                      <option value="[GJ]-Gujarat">[GJ]-Gujarat</option>
                      <option value="[HR]-Haryana">[HR]-Haryana</option> 
                      <option value="[HP]-Himachal Pradesh">[HP]-Himachal Pradesh</option>
                      <option value="[JK]-Jammu And Kashmir">[JK]-Jammu And Kashmir</option>
                      <option value="[JH]-Jharkand">[JH]-Jharkand</option>
                      <option value="[KA]-Karnataka">[KA]-Karnataka</option>
                      <option value="[KL]-Kerala">[KL]-Kerala</option>
                      <option value="[LA]-Ladakh">[LA]-Ladakh</option>
                      <option value="[LD]-Lakshadweep">[LD]-Lakshadweep</option>
                      <option value="[MP]-Madhyapradesh">[MP]-Madhyapradesh</option>
                      <option value="[MH]-Maharashtra">[MH]-Maharashtra</option>
                      <option value="[MN]-Manipur">[MN]-Manipur</option>  
                      <option value="[ML]-Meghalaya">[ML]-Meghalaya</option>
                      <option value="[MZ]-Mizoram">[MZ]-Mizoram</option>
                      <option value="[NL]-Nagaland">[NL]-Nagaland</option> 
                      <option value="[NL]-Nagaland">[NL]-Nagaland</option>
                      <option value="[OD]-Odisha">[OD]-Odisha</option>
                      <option value="[PY]-Puducherry">[PY]-Puducherry</option>
                      <option value="[PB]-Punjab">[PB]-Punjab.</option>
                      <option value="[RL]-Rajasthan">[RL]-Rajasthan</option>
                      <option value="[SK]-Sikkim">[SK]-Sikkim</option>
                      <option value="[TN]-Tamilnadu">[TN]-Tamilnadu</option>
                      <option value="[TS]-Telenghana">[TS]-Telenghana</option>
                      <option value="[TR]-Tripura">[TR]-Tripura</option>
                      <option value="[UP]-Uttar Pradesh">[UP]-Uttar Pradesh</option>
                      <option value="[UK]-Utharakhand">[UK]-Utharakhand</option>
                      <option value="[WB]-West Bengal">[WB]-West Bengal</option>
                      <option value="[OT]-Other Territory">[OT]-Other Territory</option>
                  </select>
                  </div>
                </div>

                <hr>
              
                 
                <div class="row">
                  <div class="col-md-6 mt-2">
                    <div class="row">
                      <div class="col-md-3">
                        <label for="" class="labels">Payment No.</label>
                      </div>
                      <div class="col-md-9">
                        <input type="text" class="form-control bg-black text-white" name="payment_no"  id="paymentNumber" placeholder="{{payNo}}" required>
                        <span class="text-danger ml-1" id="payNoErr"></span>
                      </div>
                    </div>
                  </div>
  
                  <div class="col-md-6 mt-2">
                    <div class="row">
                      <label for="" class="col-md-3 labels">Reference No.</label>
                      <div class="col-md-9">
                        <input type="text" class="form-control bg-black text-white" name="reference_number" value="{{ref_no}}" readonly>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 mt-2">
                    <div class="row">
                      <label for="" class="col-md-3 labels">Date</label>
                      <div class="col-md-9">
                        <input type="date" class="form-control bg-black text-white" id="Date" name="date" value="{% now 'Y-m-d' %}">
                      </div>
                    </div>
                  </div>
  
                  
  
                  <div class="col-md-6 mt-2">
                    <div class="row">
                      <label for="" class="col-md-3 labels">Payment Type</label>
                      <div class="col-md-9">
                        <select class="form-control bg-black text-white" id="paymentMethod" name="payment_method">
                          <option value="" selected>Select Payment Method</option>
                          <option value="Cash">Cash</option>
                          <option value="Cheque">Cheque</option>
                          <option value="UPI">UPI</option>
                          {% for b in banks %}
                          <option value="{{b.bnk_name}}" text="{{b.id}}">{{b.bnk_name}} (XXX{{ b.bnk_acno|slice:"-4:" }})</option>
                          {% endfor %}
                      </select>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 mt-2">
                    <div class="row" style="display:none;"  id="chequediv">
                      <div class="col-md-3">
                        <label for="" class="labels">Cheque No.</label>
                      </div>
                      <div class="col-md-9">
                        <input type="text" class="form-control bg-black text-white" name="cheque_id" id="cheque_id" placeholder="Enter Cheque No">
                      </div>
                    </div>

                    <div class="row" style="display:none;"  id="upidiv">
                      <div class="col-md-3">
                        <label for="" class="labels">UPI No.</label>
                      </div>
                      <div class="col-md-9">
                        <input type="text" class="form-control bg-black text-white" name="upi_id" id="upi_id" placeholder="Enter UPI ID">
                      </div>
                    </div>

                    <div class="row" style="display:none;"  id="bnkdiv">
                      <div class="col-md-3">
                        <label for="" class="labels">Bank Acc No.</label>
                      </div>
                      <div class="col-md-9">
                        <input type="text" class="form-control bg-black text-white" name="bnk_id" id="bnk_id" readonly>
                      </div>
                    </div>

                  </div>

                  <div class="col-md-6 mt-2"></div>
                </div>
               <hr>
                
              <div class="row mt-4">
                <div class="col-12 table-responsive">
                  <table class="table table-bordered" id="billTable">
                    <thead>
                        <tr>
                            <th class="text-center text-white ">Type</th>
                            <th class="text-center text-white ">Date</th>
                            <th class="text-center text-white ">Bill Number</th>
                            <th class="text-center text-white ">Balance Amount</th>
                            <th class="text-center text-white ">Payment</th>
                        </tr>
                    </thead>
                    <tbody id="items-table-body">
                        <tr id='tab_row1'>
                           
                        </tr>
                    </tbody>
                    
                  </table>
                </div>
              </div>


              <div class="row clearfix" style="margin-top:20px;">
                <div class="col-md-6">
                    <textarea class="form-control bg-black text-white mt-3"  id="" name="note" placeholder="Note" style="height: 190px;"></textarea>
                    <input type="file" class="form-control" name="file"  style="margin-top: 10px;">
                    <textarea class="form-control bg-black text-white mt-3"  id="" name="terms" placeholder="Terms & conditions" style="height: 130px;"></textarea>
                </div>            
                <div class="col-md-1"></div>
                <div class="col-md-5 table-responsive-md mt-3 " id="billTableTotal" style="background-color:rgba(0,0,0,.4); border: 1px solid rgba(128, 128, 128, 0.6); margin-left: -2vh; height: 160px;">
                    <div class="p-3">
                        <div class="row container-fluid p-2 m-0">
                            <div class="col-sm-4 mt-2"><label class="text-center text-white">Total_Amount</label></div>
                            <div class="col-sm-1 mt-2">:</div>
                            <div class="col-sm-7 mt-2"><input type="number" step="any" name='totalamt' value=0.00 readonly class="form-control bg-black text-white" id="total_amt"></div>
                        </div>
                    
                       
                        
                        
                        <div class="row container-fluid p-2 m-0">
                            <div class="col-sm-4 mt-2"><label for="a" class="text-center text-white">Total_Balance</label></div>
                            <div class="col-sm-1 mt-2">:</div>
                            <div class="col-sm-7 mt-2"><input type="number" name='totalbal' id="total_bal" value=0.00 readonly class="form-control bg-black text-white"/></div>
                        </div>
                    </div>
                </div>
            </div>
            
                




                <br>
                <div class="mt-4">
                  <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="" id="agreeTerms" required>
                      <label for="agreeTerms">Agree to terms and conditions</label>
                      <div class="invalid-feedback">You must agree before submitting.</div>
                  </div>
                </div>
                <div class="mt-4">
                  <input type="submit" class="btn save_btn" style="background-color: chocolate; color: white;" value="SAVE" name="Saved" id="save">
                  <input class="btn save_btn" style="background-color: chocolate; color: white;" type="submit" value="DRAFT" name="Draft" id="draft">
                  <input class="btn save_btn" style="background-color: chocolate; color: white;" type="reset" onclick="window.location.href=`{% url 'recurringInvoice' %}`" value="CANCEL" id="cancel">
                </div>
              </form>
            </div>
          </div>
      </div>
  </div>
</div>


<!-- vendor modal -->
<div class="modal fade" id="newVendor">
    <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
            <div class="modal-header">
                <h5 class="m-3 text-white">New Vendor</h5>
                <button type="button" class="close btn btn-danger" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="rounded p-2" style="background-color: black;">
                    <form  method="post" action="{% url 'recurr_vendor_create' %}"  enctype="multipart/form-data" class="mb-3">
                        {% csrf_token %}
                
                        <div class=" form-group row">
                            <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                                <label>Primary Contact</label>
                            </div>
                            <div class="col-sm-12 col-md-1 col-lg-1" >
                                <select id="select2"  name="salutation" class="form-control bg-light text-dark mt-2 " >
                                
                                    <option value="Mr">Mr</option>
                                    <option value="Mrs">Mrs</option>
                                    <option value="Ms">Ms</option>
                                    <option value="Dr">Dr</option>
        
                                </select> 
                            </div>
                            <div class="col-sm-12 col-md-2 col-lg-3" >
                                <input  type="text" class="form-control bg-light text-dark mt-2 change-disply " id="fname2" name="first_name" placeholder="first name" required >
        
                            </div>
                            <div class="col-sm-12 col-md-2 col-lg-3" >
                                <input type="text" class="form-control bg-light text-dark mt-2 " id="lname2" name="last_name" placeholder="last name" required >
        
                            </div>
                        </div>
        
                        <div class="form-group row mt-4">
                            <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                                <label>Company Name</label>
                            </div>
                            <div class="col-sm-12 col-md-6 col-lg-7">
                                <input  type="text" class="form-control bg-light text-dark " name="company_name" required>     
                                <div class="invalid-feedback">Please fill out this field.</div>   
        
                            </div>
                        </div>
        
                       
        
                        <div class="form-group row mt-4">
                            <div class="col-sm-12 col-md-3 col-lg-3 col-form-label"><label>Vendor Display Name</label></div>
                            <div class="col-sm-12 col-md-6 col-lg-7">
                               
                                <!-- <input class="form-control bg-light text-dark "  name="v_display_name" id="v_display_name1" readonly> -->
                                <select class="form-control bg-light text-dark "  name="v_display_name" id="v_display_name2">
                            
                                </select>
                                   
                                    
                            </div>
                        </div>
        
                        <div class="form-group row mt-4">
                            <div class="col-sm-12 col-md-3 col-lg-3 col-form-label"><label>Vendor Email</label></div>
                            <div class="col-sm-12 col-md-6 col-lg-7">
                                <input  type="email" class="form-control bg-light text-dark" name="vendor_email"  id="vendor-email"  required> 
                                <span class=" text-danger mt-1" id="email-message-id" style="font-size: 10px;"></span>   
                            </div>
        
        
                        </div>
        
                        <div class="form-group row mt-4">
                            <div class="col-sm-12 col-md-3 col-lg-3 ">
                                <label class="col-form-label text-white">  Vendor phone</label>
                            </div>
                            <div class="col-sm-12 col-md-3 col-lg-3">
                                <input id="workphone1"  type="number" class="form-control bg-light text-dark mt-2" pattern="[0-9]{7}"  name="w_phone" placeholder="work phone" required>
                                <span id="work-phone-message1" class="mt-2 " style="font-size: 10px;"></span >
                                <span id="workphone_label1" class="mt-2 text-danger" style="font-size: 10px;"></span >
                                <div class="invalid-feedback1"></div>   
            
                            </div>
                            <div class=" col-sm-12 col-md-3 col-lg-4">
                                <input id="mphone1"  type="number" pattern="[0-9]{10}" class="form-control bg-light text-dark mt-2"  name="m_phone" placeholder="mobile number" required>
                                <span id="phone-message1" class="mt-2 " style="font-size: 10px;"></span >
                                <span id="mphone_label1" class="mt-2 text-danger" style="font-size: 10px;"></span >
                                <div class="invalid-feedback1"></div>   
            
                            </div>
        
                            <hr style="border: none; height: 2px; background-color: #ffcc00; margin: 20px 0;">
        
                            <div class="toggle1 section-toggle">
                                <a href="">More Details</a>
        
                            </div>
        
        
                        </div>
                        
        
                        <fieldset1 id="more_detail" class="more details" style="display: none;">
        
                            <div class="form-group row mt-4">
                                <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                                    <label>Skype name/Number</label>
                                </div>
                                <div class="col-sm-12 col-md-6 col-lg-6">
                                    <input  type="text" class="form-control bg-light text-dark" name="skype_number">      
                                </div>
        
                            </div>
        
                            <div class="form-group row mt-4">
                                <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                                    <label>Designation</label>
                                </div>
                                <div class="col-sm-12 col-md-6 col-lg-6">
                                    <input  type="text" class="form-control bg-light text-dark" name="designation">      
                                </div>
        
                            </div>
        
                            <div class="form-group row mt-4">
                                <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                                    <label>Department</label>
                                </div>
                                <div class="col-sm-12 col-md-6 col-lg-6">
                                    <input  type="text" class="form-control bg-light text-dark" name="department">      
                                </div>
        
                            </div>
        
        
                   
                        <div class="form-group row mt-4">
                            <div class="col-sm-12 col-md-3 col-lg-3 col-form-label"><label>Website</label></div>
                            <div class="col-sm-12 col-md-6 col-lg-6">
                                <input id="web" type="text" class="form-control bg-light text-dark" onclick="mobile_phone()"    name="website">      
                            </div>
                        </div>
                    </fieldset1>
        
        
                        <hr style="border: none; height: 2px; background-color: #ffcc00; margin: 20px 0;">
        
                        <div class="section-3">
        
                            <div class="toggle2 section-toggle"> <a href="" >Other Details </a> </div>
                            <div class="toggle3 section-toggle" > <a href="">Address </a> </div>
                            <div class="toggle4 section-toggle"><a href="" >Contact Persons </a></div>
                            <div class="toggle7 section-toggle"><a href="">Remarks</a></div>
        
                        </div>
        
                       
                        <fieldset2 class="other details">
        
                            <div class="form-group row mt-2">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > GST Treatment*</label>
                                
                                <div class=" col-sm-12 col-md-3 col-lg-3">
                                    <select name="gst" id="GSTT1" class="form-control bg-light text-dark" onclick="gstPan_function()" required>
                                        <option value="Select a Gst Treatment" selected>Select a Gst Treatment</option>
                                        <option value="Registered Business-Regular Business that is registered under GST">Registered Business-Regular Business that is registered under GST</option>
                                        <option value="Registered Business-Composition Business that is registered under the Composition scheme in GST">
                                            Registered Business-Composition Business that is registered under the Composition schemen in GST
                                        </option>
                                        <option value="Unregistered Business-not Registered under GST">Unregistered Business-not Registered under GST</option>
                                        <option value="Overseas- Persons with who you do import or exports of supplies outside india">Overseas- Persons with who you do import or exports of supplies outside india</option>
                                        <option value="Special Economic Zone">Special Economic Zone</option>
                                    </select><br>
                                </div>
        
        
                            </div>
        
                            <fieldset3 id="gst1" style="display: none;">
                                <div class="row mt-4">
                                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white"  > GSTIN/UIN*</label>
                                    
                                    <div class=" col-sm-12 col-md-3 col-lg-3">
                                        <input type="text" class="form-control bg-light text-dark" name="gst_number" id="gstInput1" > 
                                        <span id="gstMessage1"></span>       
                
                                    </div>
                
                
                                </div>
        
                            </fieldset3>
        
                            <fieldset4 id="pan1" style="display: none;">
                                <div class=" row mt-4">
                                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > PAN</label>
                                    
                                    <div class=" col-sm-12 col-md-3 col-lg-3">
                                        <input type="text" class="form-control bg-light text-dark"  id="panInput1"  name="pan_number">  
                                        <span id="panMessage1"></span>    
        
                
                                    </div>
                
                
                                </div>
        
                            </fieldset4>
        
        
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Source Of Supply*</label>
                                
                                <div class=" col-sm-12 col-md-3 col-lg-3">
                                    <select name="source_supply" id="PLACE" class="form-control bg-light text-dark" required>
                                        <option value="value" selected></option>
                                        <option value="[AN]-Andaman And Nicobar Islands">[AN]-Andaman And Nicobar Islands</option>
                                        <option value="[AD]-Andhra Pradesh">[AD]-Andhra Pradesh</option>
                                        <option value="[AR]-Arunachal Pradesh">[AR]-Arunachal Pradesh	</option> 
                                        <option value="[AS]-Assam">[AS]-Assam</option>
                                        <option value="[BR]-Bihar">[BR]-Bihar</option> 
                                        <option value="[CH]-Chandhigarh">[CH]-Chandhigarh</option>
                                        <option value="[CG]-Chattisgarh">[CG]-Chattisgarh</option>
                                        <option value="[DD]-Daman Diu">[DD]-Daman Diu</option>
                                        <option value="[DL]-Delhi">[DL]-Delhi</option>
                                        <option value="[GA]-Goa">[GA]-Goa</option> 
                                        <option value="[GJ]-Gujarat">[GJ]-Gujarat</option>
                                        <option value="[HR]-Haryana">[HR]-Haryana</option> 
                                        <option value="[HP]-Himachal Pradesh">[HP]-Himachal Pradesh</option>
                                        <option value="[JK]-Jammu And Kashmir">[JK]-Jammu And Kashmir</option>
                                        <option value="[JH]-Jharkand">[JH]-Jharkand</option>
                                        <option value="[KA]-Karnataka">[KA]-Karnataka</option>
                                        <option value="[KL]-Kerala">[KL]-Kerala</option>
                                        <option value="[LA]-Ladakh">[LA]-Ladakh</option>
                                        <option value="[LD]-Lakshadweep">[LD]-Lakshadweep</option>
                                        <option value="[MP]-Madhyapradesh">[MP]-Madhyapradesh</option>
                                        <option value="[MH]-Maharashtra">[MH]-Maharashtra</option>
                                        <option value="[MN]-Manipur">[MN]-Manipur</option>  
                                        <option value="[ML]-Meghalaya">[ML]-Meghalaya</option>
                                        <option value="[MZ]-Mizoram">[MZ]-Mizoram</option>
                                        <option value="[NL]-Nagaland">[NL]-Nagaland</option> 
                                        <option value="[NL]-Nagaland">[NL]-Nagaland</option>
                                        <option value="[OD]-Odisha">[OD]-Odisha</option>
                                        <option value="[PY]-Puducherry">[PY]-Puducherry</option>
                                        <option value="[PB]-Punjab">[PB]-Punjab.</option>
                                        <option value="[RL]-Rajasthan">[RL]-Rajasthan</option>
                                        <option value="[SK]-Sikkim">[SK]-Sikkim</option>
                                        <option value="[TN]-Tamilnadu">[TN]-Tamilnadu</option>
                                        <option value="[TS]-Telenghana">[TS]-Telenghana</option>
                                        <option value="[TR]-Tripura">[TR]-Tripura</option>
                                        <option value="[UP]-Uttar Pradesh">[UP]-Uttar Pradesh</option>
                                        <option value="[UK]-Utharakhand">[UK]-Utharakhand</option>
                                        <option value="[WB]-West Bengal">[WB]-West Bengal</option>
                                        <option value="[OT]-Other Territory">[OT]-Other Territory</option>
                                    </select>
                                </div>
            
            
                            </div>
                            
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Currency*</label>
                                
                                <div class=" col-sm-12 col-md-3 col-lg-3">
                                    <select name="currency" id="PLACE" class="form-control bg-light text-dark" required>
                                        <option value="Indian Rupee" selected>Indian Rupee</option>
                                        <option value="Indian Rupee">Indian Rupee</option>
                            
                                    </select>
                                </div>
            
            
                            </div>
        
                            <div class="form-group row mt-2">
                                <div class="col-sm-12 col-md-3 col-lg-3 ">
                                   <label class="col-form-label text-white mb-3"> Opening Balance Type</label>
                                </div>
                                <div class="col-sm-12 col-md-3 col-lg-4 d-flex align-items-center">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="op_type" id="debit" value="debit">
                                        <label class="form-check-label text-white" for="debit">Debit</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="op_type" id="credit" value="credit">
                                        <label class="form-check-label text-white" for="credit">Credit</label>
                                    </div>
                                </div>
                            </div>
        
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Opening Balance Amount</label>                    
                                <div class=" col-sm-12 col-md-3 col-lg-3">
                                    <input  type="number" class="form-control bg-light text-dark" name="opening_bal" value="0.00">      
                                </div>
                            </div>
                            
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Payment Terms</label>
                                
                                <div class=" col-sm-12 col-md-3 col-lg-3">
                                    <select name="payment_terms" id="paytearm-select" class="form-control bg-light text-dark" required>
                                       
        
                                        {% for pay_terms in payments %}
                                        <option value="{{pay_terms.id}}" >{{pay_terms.term_name}}</option>
                                    {% endfor %}
                                        
                                    </select>
        
                                </div>
            
                                <div class="col-md-4 ">
                                    <a href="#" class="btn btn-outline-secondary py-2 my-1" data-target="#newpayment" data-toggle="modal" style="color: white; background-color: rgb(210, 132, 30);" >+</a>
                                </div>
                            
        
        
        
            
                            </div>
        
                
                        </fieldset2>
        
        
                        <!------------------ Address Section Start------------- -->
        
                        <fieldset5 id="address" style="display: none;">
                            <div>
                                <div class="row">
                                    <div class="col-sm-12 col-md-6 col-lg-6">
                                        <div class="row">
                                            <div class="col-sm-12 col-md-6 col-lg-6">
                                                <label for="">BILLING ADDRESS</label>
                                            </div>
                                            <div class="col"></div>
                                        </div>
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Attention</label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <input  type="text" class="form-control bg-light text-dark" name="battention" id="batten">      
                                            </div>
                                        </div>
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Country</label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <select name="bcountry" id="btry" class="form-control bg-light text-dark">
                                                    <option value="India" selected>India</option>
                                                </select>      
                                            </div>
                                        </div>
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Address</label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <textarea class="form-control bg-light " style="border: none;color: rgb(7, 7, 7);" cols="26" rows="4" name="baddress" id="badd1"></textarea>
                                            </div>
                                        </div>
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > City</label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <input  type="text" class="form-control bg-light text-dark" name="bcity" id="bcty">      
                                            </div>
                                        </div>
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > State</label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <input type="text" class="form-control bg-light text-dark" name="bstate" id="bste">      
                                            </div>
                                        </div>
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Zip Code </label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <input  type="number" class="form-control bg-light text-dark" name="bzip" id="bzp">      
                                            </div>
                                        </div>
                                    
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Phone </label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <input id="bphone_num"  type="tel" pattern="[0-9]{10}" class="form-control bg-light text-dark" name="bphone" >
                                                <label for="" id="bphone_label"></label>      
                                            </div>
                                        </div>
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Fax </label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <input  type="tel" class="form-control bg-light text-dark" pattern="[0-9]{7}" onmouseout="fax_number()"  onclick="bphone_number()"                                       name="bfax" id="bfx">  
                                            
                                                <label for="" id="fax_label"></label> 
                                            </div>
                                        </div>
        
                                    </div>
                                    <div class="col-sm-12 col-md-6 col-lg-6">
                                        <div class="row">
                                            <div class="col-sm-12 col-md-6 col-lg-6">
                                                <label for="">SHIPPING ADDRESS</label>
                                            </div>
                                            <div class="col-sm-12 col-md-6 col-lg-6">
                                                <input  type="checkbox" id="myCheckT" onclick="myCopyAddressFunction()">&nbsp;
                                                <label for="myCheck">Same as Billing Address:</label>
                                            </div>
                                        </div>
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Attention</label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <input  type="text" class="form-control bg-light text-dark " style="color: white;" name="sattention" id="satten">      
                                            </div>
                                        </div>
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Country</label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <select name="s_country" id="sctry" class="form-control bg-light text-dark">
                                                    <option value="India" selected>India</option>
                                                </select>      
                                            </div>
                                        </div>
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Address</label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <textarea class="form-control bg-light" style="border: none;color: rgb(10, 10, 10);" id="sadd1" cols="26" rows="4" name="saddress"></textarea>
                                            </div>
                                        </div>
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > City</label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <input  type="text" class="form-control bg-light text-dark" name="scity" id="scty">      
                                            </div>
                                        </div>
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > State</label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <input type="text" class="form-control bg-light text-dark" name="sstate" id="sste">      
                                            </div>
                                        </div>
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Zip Code </label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <input  type="number" class="form-control bg-light text-dark" name="szip" id="szp">      
                                            </div>
                                        </div>
                                    
        
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Phone </label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <input  type="tel" class="form-control bg-light text-dark" pattern="[0-9]{10}" style="color: white;" name="sphone" id="sphone_num">  
                                                <label for="" id="sphone_label"></label>    
                                            </div>
                                        </div>
                                        <div class="form-group row mt-4">
                                            <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Fax </label>                    
                                            <div class=" col-sm-12 col-md-6 col-lg-6">
                                                <input  type="tel" class="form-control bg-light text-dark" pattern="[0-9]{7}" style="color: white;" name="sfax" onclick="sphone_number()" onmouseout="sfax_number()" id="sfx"> 
                                                <label for="" id="sfax_label"></label>     
                                            </div>
                                        </div>
        
                                    </div>
                                </div>
                            </div>
                        </fieldset5>
        
                        <!---------------------Address  Section End -------------->
        
        
                        <!------------------ Contact Person Section Start------------- -->
        
                        <fieldset6 id="contact_person" style="display: none;" >
                            <div class="row">
                                <div class="col-sm-12 ">
                                    
                                    <div class="table-responsive">
                                    
                                        <table id="tbl" class="table text-white" style="background-color: rgba(250, 227, 198, 0.5);">
                                            <thead>
                                                <tr>
                                                    
                                                <th>Salutation</th>
                                                <th>First Name</th>
                                                <th>Last Name</th>
                                                <th>Email Address</th>
                                                <th >Work Phone <br><span id="twph_label"></span></th>
                                                <th >Mobile <br><span id="tlabel"></span>    </th>
                                                <th >Skype Name/No</th>
                                                <th >Designation</th>
                                                <th >Department</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                            <td><select name="salutation[]" class="form-control bg-transparent border-1 text-white"  id="PLACE" >
                                                <option class="text-dark"  >Select</option>
                                                <option class="text-dark" value="Mr" >Mr.</option>
                                                <option class="text-dark" value="Mrs">Mrs.</option>
                                                <option class="text-dark" value="Ms">Ms.</option>
                                                <option class="text-dark" value="Miss">Miss.</option>
                                                <option class="text-dark" value="Dr">Dr.</option>
                                                </select></td>
                                            <td><input type="text" class=" form-control border-1 bg-transparent text-white"    name="first_name[]"  ></td>
                                            <td><input type="text"class="form-control border-1 bg-transparent text-white"  name="last_name[]" /></td>
                                            <td>
                                                <input type="text" class="form-control border-1 bg-transparent text-white" name="email[]" />
                                                
                                                
                                            </td>
                                            
                                            <td>
                                                <input type="tel" pattern="[0-9]{7}" class="form-control border-1 bg-transparent text-white"  id="twphone" name="wphone[]"/>
                                               
                                            </td>
                                            <td>
                                                <input type="tel" pattern="[0-9]{10}"  class="form-control border-1 bg-transparent text-white"  id="tmobile" onclick="sample1()"   name="mobile[]" />
                                                
                                            </td>
                                            <td><input type="number" class="form-control border-1 bg-transparent text-white"  onclick="sample()" name="skype[]" /></td>
                                            <td><input type="text" class="form-control border-1 bg-transparent text-white"  name="designation[]" /></td>
                                            <td><input type="text" class="form-control border-1 bg-transparent text-white"  name="department[]" /></td>
                                            </tr>
                                        </tbody>
                                        </table>
                                        
                                    </div>
                                    
                                    <div class="button add_another mt-3 ">
                                        <i class="fa fa-user-plus" aria-hidden="true"></i> 
                                        <span class="text-small" style="margin-left: 0.30rem;">
                                            Add Contact Person
                                        </span>
                                    </div>
                                       
                                    
                                </div>
                                
                            </div>
        
                        </fieldset6>
        
                        <!---------------------Contact Person Section End -------------->
        
        
                        <!------------------ Remark Section Start------------- -->
        
                        <fieldset7 class="remarks" style="display: none;">
                            <div class="row">
                                <div class="col-sm-12 col-md-8 col-lg-8">
                                    <div class="form-group row mt-4">
                                        <div class=" col-sm-12 col-md-6 col-lg-6">
                                            <textarea class="bg-light w-100" style="border: none;color: rgb(5, 5, 5);"   rows="5" name="remark"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-2 col-lg-2"></div>
                            </div>
        
                        </fieldset7>
        
                        <!---------------------Remark Section End -------------->
                        
                        <div class="row mt-5">
                            <div class="col-sm-12 col-md-2 col-lg-2 mt-3">
                                <button type="submit" class="btn btn-outline-warning form-control bg-warning text-dark" style="font-weight: bold;">Save</button>
                               
                            </div>
                            
                            <div class=" col-sm-12 col-md-2 col-lg-2 mt-3">
                                <button type="reset" class="form-control  bg-warning text-dark" style="font-weight: bold;">Cancel</button>
                               
                            </div> 
        
        
                        </div>
        
               
        
                    </form>
                </div>
            </div>
        </div>   
    </div>
</div>
<div class="modal fade" id="newpayment">
    <div class="modal-dialog modal-md">
    <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
        <div class="modal-header " style="background: rgb(32, 35, 37);">
            <h3 class="m-3 text-uppercase" style="color: white;">Add Payment Term</h3>
            <button type="button" class="close btn btn-danger" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body" style="background: rgb(32, 35, 37);">
        <div class="card p-3 m-3" style="background-color: #141414a2;">
            <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalPayment_terms">
            


            <div class="row mt-2">

                <div class="col-lg-12 col-md-12 col-sm-12 mt-2">
                    <label for="termname" style="color: white">Term Name *</label>

                <input type="text " class="form-control text-dark bg-light mt-2" id="tname" name="term_name" autocapitalize="characters" required> 
                <span id="message-id" class="mt-1 text-danger" style="font-size: 10px;"></span> 
                <span id="success-message-id" class=" mt-1 text-success" style="font-size: 10px;"></span>    
                </div>

                <div class="col-lg-12 col-md-12 col-sm-12 mt-2">
                    <label for="termdays" style="color: white">Number of Days *</label>

                <input type="number" class="form-control text-dark bg-light mt-2" id="tdays" name="term_days" autocapitalize="characters" required>
                </div>
                <div class="col-md-2 mt-2"></div>

            </div>
            
            <div class="row mt-5">
                <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="d-flex">
                    <button class="btn save_btn rounded-pill text-grey w-50 my-1 mx-1 btn-outline-warning "
                    type="submit" data-dismiss="modal" id="termSave1">Save
                    </button> 
                    

                    <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-1 mx-1 btn-outline-warning" 
                    data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Cancel</span>
                    </button>
                </div>
                </div>
            </div>
            </form>
        </div>
        </div>
    </div>
    </div>  
</div> 

<script>
  function filtervendors(){
      var options = $('#vend_drop').children();
      var search_text = $("#vendor").val().toLowerCase();
      options.each(function(){
          if($(this).text().toLowerCase().includes(search_text)){
              $(this).show()
          }else{
              $(this).hide()
          }
      })
  }

    function getCustomerDetails(custId, name){
      $('#customer').val(name)
      console.log('name',name);
      if($('#customer').val() != ""){
          $('#custErr').text('');
          $.ajax({
              type : 'POST',
              url: "{% url 'getCustomerDetailsAjax' %}",
              data: {
                  id: custId,
                  csrfmiddlewaretoken: '{{ csrf_token }}',
              },
              
              success: function(data){
                  console.log('AJAX-Response-->',data);
                  document.getElementById('customerId').value = data.id;
                  document.getElementById('customerEmail').value = data.email;
                  document.getElementById('placeOfSupply').value = data.shipState;
                  document.getElementById('customerGstType').value = data.gstType;
                  if(data.street == "" && data.city == "" && data.state == ""){
                    $("#billAddressSection").hide();
                  }else{
                    $('#billAddressSection').show();
                    document.getElementById('billAddress').value = data.street + ',' + data.city + '\n' + data.state + '\n' + data.country  + '\n' + data.pincode ;
                  }
                  if(data.gstin){
                      document.getElementById('customerGstInDisplay').style.display = 'flex';
                      document.getElementById('customerGSTIN').value = data.gstNo;
                  }else{
                      document.getElementById('customerGstInDisplay').style.display = 'none';
                      document.getElementById('customerGSTIN').value = '';
                  }
                  $('#applyPriceList').prop('checked') ? $('#applyPriceList').prop('checked', false) : $('#applyPriceList').prop('checked',false);
                  refreshTax();
                  checkPriceList();
              }
          });
      }else{
          document.getElementById('customerEmail').value = "";
          document.getElementById('placeOfSupply').value = "";
          document.getElementById('customerGstType').value = "";
          document.getElementById('billAddress').value ="";
          document.getElementById('customerGSTIN').value = "";
          $('#custErr').text('Select a customer..');
      }
  }


  $(document).ready(function() {
        $("#paymentMethod").change(function() {
            var x=$('#paymentMethod').val();
            if(x==='Cash'){
                $('#chequediv').hide()
                $('#bnkdiv').hide()
                $('#upidiv').hide()
                document.getElementById('cheque_id').value=""
                document.getElementById('upi_id').value=""
                document.getElementById('bnk_id').value=""
            }else if(x==='Cheque'){
                $('#chequediv').show()
                $('#bnkdiv').hide()
                $('#upidiv').hide()
                document.getElementById('upi_id').value=""
                document.getElementById('bnk_id').value=""
            }else if(x==='UPI'){
                $('#upidiv').show()
                $('#bnkdiv').hide()
                $('#chequediv').hide()
                document.getElementById('cheque_id').value=""
                document.getElementById('bnk_id').value=""
            }else{
                $('#bnkdiv').show()
                $('#chequediv').hide()
                $('#upidiv').hide()
                document.getElementById('cheque_id').value=""
                document.getElementById('upi_id').value=""

                $.ajax({
                    type: "GET",
                    url: "{% url 'getBankAccountNumberAjax' %}",
                    data: {
                        id: $('#paymentMethod').find(':selected').attr('text'),
                    },
                    success: function (response) {
                        if (response.status){
                            document.getElementById('cheque_id').value="";
                            document.getElementById('upi_id').value="";
                            document.getElementById("bnk_id").value = response.account;
                        }else{
                            alert(response.message);
                        }
                    }
                });
            }
        });
    });



   
    $(document).ready(function(){
        $('#items-table-body').on('keyup change', function () {
            refreshTax();
            calc();
        });
    });

    $(document).ready(function(){
        $(document).on("blur", ".disc", function(){
            if($(this).val() != ""){
            }else{
            $(this).val(0);
            calc();
            }
        }); 
    });

    // calculation---------------------------

    function calc() {
      $('#invoiceItemsTable tbody tr').each(function () {
        var html = $(this).html();
        if (html != '') {
          var qty = $(this).find('.qty').val();
          if($('#applyPriceList').prop('checked') && $('#priceListIds').val() != ""){
              var price = $(this).find('.priceListPrice').val();
          }else{
              var price = $(this).find('.price').val();
          }
          var dis = $(this).find('.disc').val();
          var bc = $("#placeOfSupply").val();
          var compstate = $("#cmpstate").val();

          if(bc==compstate){
              var tax = $(this).find('.tax_ref_gst').val();
          }
          else{
              var tax = $(this).find('.tax_ref_igst').val();
          }
          $(this).find('.total').val((parseFloat(qty) * parseFloat(price)) - parseFloat(dis));
          $(this).find('.itemTaxAmount').val(((qty * price)-dis) * (tax / 100));
          calc_total();
        }
      });
    }

    function calc_total() { 
      total = 0;
      $('.total').each(function () {
          total += parseFloat($(this).val());
      });
      taxamount = 0;
      $('.itemTaxAmount').each(function () {
          taxamount += parseFloat($(this).val());
      });
      $('#sub_total').val(total.toFixed(2));
      $('#tax_amount').val(taxamount.toFixed(2));
      var ship = parseFloat($("#ship").val());
      var adj_val = parseFloat($('#adj').val())
      var gtot = taxamount + total + ship + adj_val;

      $('#grandtotal').val(gtot.toFixed(2));
      
      var adv_val = parseFloat($('#advance').val())
      var bal = gtot - adv_val
      $('#balance').val(bal.toFixed(2));
      splitTax();
    }

    function splitTax(){
    var bc = $("#placeOfSupply").val();
    var compstate = $("#cmpstate").val();
    d=0
    if (bc == compstate  ) {
        var gst = taxamount/2
        $('#cgstAmount').val(parseFloat(gst.toFixed(2)));
        $('#sgstAmount').val(parseFloat(gst.toFixed(2)));
        $('#igstAmount').val(parseFloat(d.toFixed(2)));
    }else{
        $('#igstAmount').val(taxamount.toFixed(2));
        $('#cgstAmount').val(d.toFixed(2));
        $('#sgstAmount').val(d.toFixed(2));
    }   
  }

    $(document).ready(function(){
      $(document).on('keyup',"#ship",function(){
          var subtot = $('#sub_total').val();
          var tax = $('#tax_amount').val();
          var sh = $("#ship").val();
          var adj = $("#adj").val();
          $('#grandtotal').val((parseFloat(subtot)+parseFloat(tax)+parseFloat(sh)+parseFloat(adj)).toFixed(2));
          $('#balance').val((parseFloat($("#grandtotal").val())-parseFloat($("#advance").val())).toFixed(2))
          
      });

      $(document).on("blur", "#ship", function(){
          if($(this).val() != ""){
          }else{
          $(this).val(0);
          calc_total();
          }
      }); 
    });

    $(document).ready(function(){
      $(document).on("keyup", "#adj", function(){
          var subtot = $('#sub_total').val();
          var tax = $('#tax_amount').val();
          var sh = $("#ship").val();
          var adj = $("#adj").val();
          $('#grandtotal').val((parseFloat(subtot)+parseFloat(tax)+parseFloat(sh)+parseFloat(adj)).toFixed(2));
          $('#balance').val((parseFloat($("#grandtotal").val())-parseFloat($("#advance").val())).toFixed(2))
      });

      $(document).on("blur", "#adj", function(){
          if($(this).val() != ""){
          }else{
          $(this).val(0);
          calc_total();
          }
      }); 
    });

    $(document).ready(function() {
      $("#advance").on('keyup change',function() {
          var tot_val = $('#grandtotal').val();
          var adv_val = $('#advance').val();
          if(adv_val !=""){
              if (parseFloat(tot_val) < parseFloat(adv_val)){
                  $('#advance').val(parseFloat(tot_val))
                  $('#balance').val(0);
                  alert("Advance Greater than Total Amount")
      
              }else{
                  var bal = parseFloat(tot_val) - parseFloat(adv_val)
                  $('#balance').val(bal.toFixed(2));
              }
          }else{
              $('#balance').val(parseFloat(tot_val));
          }
          
      })
    });

    // Tabel row add, clone, remove

    function refreshIndex(){
      var slNo = 1;
      var $rows = $("#items-table-body tr");

      for (var i = 0; i < $rows.length; i++) {
          $rows.eq(i).attr('id', 'tab_row'+slNo)
          $rows.eq(i).find('[id]').each(function() {
              var oldId = $(this).attr('id');
              var newId = oldId.replace(/\d+/, slNo);
              $(this).attr('id', newId );
          });

          $rows.eq(i).find('.nnum').text(slNo);
          slNo++;
      }
    }

    $(document).on('click','.remove_row',function(){
      var row_id = $(this).attr("id");
      $('#tab_row'+row_id+'').remove();
      refreshIndex();
      calc();
    });

  
    function validateForm() {
        var cust = $('#vendor').val();
        var length = $("#items-table-body tr").length;

        

        if(cust == 0){
            alert('Select vendor..')
            return false;
        }

       
    }
</script>

<!-- NEW CUSTOMER -> Scripts -->
<script>
  

$(document).ready(function() {
  $('#tname').on('blur', function() {
      
      var termName = $(this).val();
     
      $.ajax({
          type: 'GET',
          url:'{% url "check_customer_term_exist" %}',
          data: {
              term_name: termName
          },
          success: function(response) {
              if (response.exists) {
                alert('Term already exists !')
                  $('#message-id').text('Term already exists !');
                  $('#success-message-id').text('');
                
                  $('#tname').val('');
              } else {
                  $('#success-message-id').text('Term name available !');
                  $('#message-id').text('');
              }
              
          },
          error: function(xhr, status, error) {
              console.error('Error:', error);
          }
      });
  });
});


  $(document).on("click","#customerPaymentTermSave",function(){
        var trm = $('#tname').val();
        var dys = $("#tdays").val();
        if (trm !="" && dys !=""){
            $.ajax({
                type : 'POST',
                url:"{% url 'newPaymentTermAjax' %}",
                data:{
                    'term' : trm,
                    'days' : dys,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                
                success: function(response) {
                    if(response.status){
                        document.getElementById("newTermForm").reset();
                        
                        var dropdown = $('#paytearm-select');
                        dropdown.empty();
                        dropdown.append(`<option value="" selected>Choose</option>`);
                        $.each(response, function(key, value) {
                            for(let i=0; i<value.length; i++){
                                if(value[i].name == trm){
                                    dropdown.append($('<option selected></option>').text(value[i].name).val(value[i].id))
                                }else{
                                    dropdown.append($('<option></option>').text(value[i].name).val(value[i].id))
                                }   
                            }
                        });

                    }else{
                        alert("Something went wrong.!")
                    }
                },         
            });
        }
        else{
            alert('Invalid')
        }
    });


  
</script>




{%endblock%}